<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOG0114 Principles of Spatial Analysis - 1&nbsp; Geodemographics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02-network.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-geodemographics.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Geodemographics</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GEOG0114 Principles of Spatial Analysis</a> 
        <div class="sidebar-tools-main">
    <a href="./GEOG0114-Principles-of-Spatial-Analysis.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-geodemographics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Geodemographics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transport Network Analysis</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lecture-w07" id="toc-lecture-w07" class="nav-link active" data-scroll-target="#lecture-w07"><span class="header-section-number">1.1</span> Lecture slides</a></li>
  <li><a href="#reading-w07" id="toc-reading-w07" class="nav-link" data-scroll-target="#reading-w07"><span class="header-section-number">1.2</span> Reading list</a></li>
  <li><a href="#geodemographics" id="toc-geodemographics" class="nav-link" data-scroll-target="#geodemographics"><span class="header-section-number">1.3</span> Geodemographics</a>
  <ul class="collapse">
  <li><a href="#internet-user-classification-i" id="toc-internet-user-classification-i" class="nav-link" data-scroll-target="#internet-user-classification-i"><span class="header-section-number">1.3.1</span> Internet User Classification I</a></li>
  <li><a href="#task-geo-1" id="toc-task-geo-1" class="nav-link" data-scroll-target="#task-geo-1"><span class="header-section-number">1.3.2</span> Tutorial task I</a></li>
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering"><span class="header-section-number">1.3.3</span> k-means clustering</a></li>
  <li><a href="#task-geo-2" id="toc-task-geo-2" class="nav-link" data-scroll-target="#task-geo-2"><span class="header-section-number">1.3.4</span> Tutorial task II</a></li>
  </ul></li>
  <li><a href="#byl-geo" id="toc-byl-geo" class="nav-link" data-scroll-target="#byl-geo"><span class="header-section-number">1.4</span> Before you leave</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Geodemographics</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/jtvandijk/GEOG0114Q"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This week we will see how we can use socio-demographic and socio-economic data to characterise neighbourhoods using <strong>geodemographics</strong>. Geodemographics is the “<em>analysis of people by where they live (Harris et al.&nbsp;2005) and as such entails representing the individual and collective identities that are manifest in observable neighbourhood structure</em>” (<a href="https://doi.org/10.1080/13658816.2012.719623">Longley 2012</a>). We will look at geodemographics by focusing on an existing geodemographic classification known as the <a href="https://data.cdrc.ac.uk/dataset/internet-user-classification">Internet User Classification</a>.</p>
<section id="lecture-w07" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="lecture-w07"><span class="header-section-number">1.1</span> Lecture slides</h2>
<p>You can download the slides of this week’s lecture here: <a href="https://github.com/jtvandijk/GEOG0114Q/tree/master/slides/w07-psa.pdf">[Link]</a>.</p>
</section>
<section id="reading-w07" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="reading-w07"><span class="header-section-number">1.2</span> Reading list</h2>
<section id="essential-readings" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="essential-readings">Essential readings</h4>
<ul>
<li>Longley, P. A. 2012. Geodemographics and the practices of geographic information science. <em>International Journal of Geographical Information Science</em> 26(12): 2227-2237. <a href="https://doi.org/10.1080/13658816.2012.719623">[Link]</a></li>
<li>Martin, D., Gale, C., Cockings, S. <em>et al.</em> 2018. Origin-destination geodemographics for analysis of travel to work flows. <em>Computers, Environment and Urban Systems</em> 67: 68-79. <a href="https://doi.org/10.1016/j.compenvurbsys.2017.09.002">[Link]</a></li>
<li>Singleton, A., Alexiou, A. and Savani, R. 2020. Mapping the geodemographics of digital inequality in Great Britain: An integration of machine learning into small area estimation. <em>Computers, Environment and Urban Systems</em> 82: 101486. <a href="https://doi.org/10.1016/j.compenvurbsys.2020.101486">[Link]</a></li>
<li>Singleton, A. and Spielman, S. 2014. The past, present, and future of geodemographic research in the United States and United Kingdom. <em>The Professional Geographer</em> 66(4): 558-567. <a href="https://doi.org/10.1080/00330124.2013.848764">[Link]</a></li>
</ul>
</section>
<section id="suggested-readings" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="suggested-readings">Suggested readings</h4>
<ul>
<li>Goodman, A., Wilkinson, P., Stafford, M. <em>et al.</em> 2011. Characterising socio-economic inequalities in exposure to air pollution: A comparison of socio-economic markers and scales of measurement. <em>Health &amp; Place</em> 17(3): 767-774. <a href="https://doi.org/10.1016/j.healthplace.2011.02.002">[Link]</a></li>
</ul>
</section>
</section>
<section id="geodemographics" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="geodemographics"><span class="header-section-number">1.3</span> Geodemographics</h2>
<p>The <a href="https://data.cdrc.ac.uk/dataset/internet-user-classification">CDRC Internet User Classification</a> (IUC) is a bespoke geodemographic classification that describes how people residing in different parts of Great Britain interact with the Internet. For every Lower Super Output Area (LSOA) in England and Wales and Data Zone (DZ) (<a href="https://www.ons.gov.uk/methodology/geography/ukgeographies/censusgeography">2011 Census Geographies</a>), the IUC provides aggregate population estimates of Internet use and provides insights into the geography of the digital divide in the United Kingdom:</p>
<blockquote class="blockquote">
<p>“Digital inequality is observable where access to online resources and those opportunities that these create are non-egalitarian. As a result of variable rates of access and use of the Internet between social and spatial groups (..), this leads to digital differentiation, which entrenches difference and reciprocates digital inequality over time” (<a href="https://doi.org/10.1016/j.compenvurbsys.2020.101486">Singleton <em>et al.</em> 2020</a>).</p>
</blockquote>
<section id="internet-user-classification-i" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="internet-user-classification-i"><span class="header-section-number">1.3.1</span> Internet User Classification I</h3>
<p>For the first part of this week’s practical material, we will be looking at the Internet User Classification (IUC) for Great Britain in more detail by mapping it.</p>
<p>Our first step is to download the IUC data set:</p>
<ul>
<li>Open a web browser and go to the <a href="https://data.cdrc.ac.uk">data portal of the CDRC</a>.</li>
<li>Register if you need to, or if you are already registered, make sure you are logged in.</li>
<li>Search for <strong>Internet User Classification</strong>.</li>
<li>Scroll down and choose the download option for the <em>IUC 2018 (CSV)</em>.</li>
<li>Save the <code>iuc_gb_2018.csv</code> file in an appropriate folder.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-geo-iuc-download" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/iuc-download.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1.1: Download the GB IUC 2018</figcaption>
</figure>
</div>
</div>
</div>
<p>Start by inspecting the data set in MS Excel, or any other spreadsheet software such as <a href="https://www.openoffice.org/product/calc.html">Apache OpenOffice Calc</a> or <a href="https://www.apple.com/uk/numbers/">Numbers</a>. Also, have a look at the <a href="https://data.cdrc.ac.uk/system/files/iuc2018userguide.pdf">IUC 2018 User Guide</a> that provides the <strong>pen portraits</strong> of every cluster, including plots of cluster centres and a brief summary of the methodology.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>It is always a good idea to inspect your data prior to analysis to find out how your data look like. Of course, depending on the type of data, you can choose any tool you like to do this inspection (<a href="https://www.arcgis.com/index.html">ArcGIS</a>, <a href="https://www.r-project.org/">R</a>, <a href="https://qgis.org/en/site/">QGIS</a>, <a href="https://www.office.com/">Microsoft Excel</a>, etc.).</p>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-geo-iuc-in-excel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/iuc-excel.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1.2: GB IUC 2018 in Excel</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>iuc <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/index/iuc-gb-2018.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>iuc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 41,729 × 5
   SHP_ID LSOA11_CD LSOA11_NM              GRP_CD GRP_LABEL                    
    &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;                        
 1      1 E01020179 South Hams 012C             5 e-Rational Utilitarians      
 2      2 E01033289 Cornwall 007E               9 Settled Offline Communities  
 3      3 W01000189 Conwy 015F                  5 e-Rational Utilitarians      
 4      4 W01001022 Bridgend 014B               7 Passive and Uncommitted Users
 5      5 W01000532 Ceredigion 007B             9 Settled Offline Communities  
 6      6 E01018888 Cornwall 071G               9 Settled Offline Communities  
 7      7 E01018766 Cornwall 028D               9 Settled Offline Communities  
 8      8 E01019948 East Devon 010C             9 Settled Offline Communities  
 9      9 W01000539 Ceredigion 005D             5 e-Rational Utilitarians      
10     10 E01019171 Barrow-in-Furness 005E      6 e-Mainstream                 
# … with 41,719 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect data types</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(iuc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [41,729 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ SHP_ID   : num [1:41729] 1 2 3 4 5 6 7 8 9 10 ...
 $ LSOA11_CD: chr [1:41729] "E01020179" "E01033289" "W01000189" "W01001022" ...
 $ LSOA11_NM: chr [1:41729] "South Hams 012C" "Cornwall 007E" "Conwy 015F" "Bridgend 014B" ...
 $ GRP_CD   : num [1:41729] 5 9 5 7 9 9 9 9 5 6 ...
 $ GRP_LABEL: chr [1:41729] "e-Rational Utilitarians" "Settled Offline Communities" "e-Rational Utilitarians" "Passive and Uncommitted Users" ...
 - attr(*, "spec")=
  .. cols(
  ..   SHP_ID = col_double(),
  ..   LSOA11_CD = col_character(),
  ..   LSOA11_NM = col_character(),
  ..   GRP_CD = col_double(),
  ..   GRP_LABEL = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>Now the data are loaded we can move to acquiring our spatial data. As the IUC is created at the level of the Lower layer Super Output Area <a href="https://www.ons.gov.uk/methodology/geography/ukgeographies/censusgeography">Census geography</a>, we need to download its administrative borders. As the data set for the entire country is quite large, we will focus on <a href="https://en.wikipedia.org/wiki/Liverpool">Liverpool</a>.</p>
<ul>
<li>Go to the <a href="https://borders.ukdataservice.ac.uk/">UK Data Service Census support portal</a> and select <strong>Boundary Data Selector</strong>.</li>
<li>Set Country to <em>England</em>, Geography to <em>Statistical Building Block</em>, dates to <em>2011 and later</em>, and click <strong>Find</strong>.</li>
<li>Select <em>English Lower Layer Super Output Areas, 2011</em> and click <strong>List Areas</strong>.</li>
<li>Select <em>Liverpool</em> from the list and click <strong>Extract Boundary Data</strong>.</li>
<li>Wait until loaded and download the <code>BoundaryData.zip</code> file.</li>
<li>Unzip and save the file.</li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>You could also have downloaded the shapefile with the data already joined to the LSOA boundaries directly from the CDRC data portal, but this is the national data set and is quite large (75MB). Also, as we will be looking at <a href="https://en.wikipedia.org/wiki/Liverpool">Liverpool</a> today we do not need all LSOAs in Great Britain..</p>
</div>
</div>
</div>
<p>Now we got the administrative boundary data, we can prepare the IUC map by joining our <code>csv</code> file with the IUC classification to the <code>shapefile</code>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load spatial data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>liverpool <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/boundaries/england_lsoa_2011.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `england_lsoa_2011' from data source 
  `/Users/justinvandijk/Library/CloudStorage/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0114Q/data/boundaries/england_lsoa_2011.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 298 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 332390.2 ymin: 379748.5 xmax: 345636 ymax: 397980.1
Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(liverpool) <span class="sc">+</span> <span class="fu">tm_polygons</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-geo-load-those-spatial-data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-load-those-spatial-data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.3: LSOAs Liverpool</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>liv_iuc <span class="ot">&lt;-</span> <span class="fu">left_join</span>(liverpool, iuc, <span class="at">by =</span> <span class="fu">c</span>(<span class="at">code =</span> <span class="st">"LSOA11_CD"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>liv_iuc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 298 features and 7 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 332390.2 ymin: 379748.5 xmax: 345636 ymax: 397980.1
Projected CRS: OSGB36 / British National Grid
First 10 features:
                         label           name      code SHP_ID      LSOA11_NM
1  E08000012E02006934E01033755 Liverpool 062D E01033755  25097 Liverpool 062D
2  E08000012E02006932E01033758 Liverpool 060B E01033758  24070 Liverpool 060B
3  E08000012E02001356E01033759 Liverpool 010F E01033759  26845 Liverpool 010F
4  E08000012E02006932E01033762 Liverpool 060E E01033762  26866 Liverpool 060E
5  E08000012E02001396E01032505 Liverpool 050F E01032505  27848 Liverpool 050F
6  E08000012E02001396E01032506 Liverpool 050G E01032506   2429 Liverpool 050G
7  E08000012E02001396E01032507 Liverpool 050H E01032507  24242 Liverpool 050H
8  E08000012E02001373E01032508 Liverpool 027G E01032508  28413 Liverpool 027G
9  E08000012E02001373E01032509 Liverpool 027H E01032509  24339 Liverpool 027H
10 E08000012E02001354E01032510 Liverpool 008F E01032510  25167 Liverpool 008F
   GRP_CD                     GRP_LABEL                       geometry
1       2               e-Professionals POLYGON ((334276.7 391012.8...
2       4         Youthful Urban Fringe POLYGON ((335723 391178, 33...
3       7 Passive and Uncommitted Users POLYGON ((338925 394476, 33...
4       1           e-Cultural Creators POLYGON ((334612.4 391111.7...
5       7 Passive and Uncommitted Users POLYGON ((335894.7 387448.3...
6       6                  e-Mainstream POLYGON ((336256.7 387691.8...
7       3                    e-Veterans POLYGON ((336803.5 387432.7...
8      10                   e-Withdrawn POLYGON ((339299 391470, 33...
9       7 Passive and Uncommitted Users POLYGON ((338901 391308, 33...
10      7 Passive and Uncommitted Users POLYGON ((338018.2 395716.4...</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(liv_iuc) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"GRP_LABEL"</span>) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-geo-plot-those-spatial-data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-plot-those-spatial-data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.4: Internet User Classification Liverpool</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s use the same colours as used on <a href="https://mapmaker.cdrc.ac.uk/#/internet-user-classification?lon=-2.81187&amp;lat=53.31045&amp;zoom=9.58">CDRC mapmaker</a> by specifying the <strong>hex</strong> colour codes for each of our groups. Note the order of the colours is important: the colour for group 1 is first, group 2 second and so on.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define palette</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>iuc_colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#dd7cdc"</span>, <span class="st">"#ea4d78"</span>, <span class="st">"#d2d1ab"</span>, <span class="st">"#f36d5a"</span>, <span class="st">"#a5cfbc"</span>, <span class="st">"#e4a5d0"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#8470ff"</span>, <span class="st">"#79cdcd"</span>, <span class="st">"#808fee"</span>, <span class="st">"#ffd39b"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot pretty</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(liv_iuc) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"GRP_LABEL"</span>, <span class="at">palette =</span> iuc_colours) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-geo-pretty-colours" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-pretty-colours-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.5: Internet User Classification Liverpool with mapmaker colours</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="task-geo-1" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="task-geo-1"><span class="header-section-number">1.3.2</span> Tutorial task I</h3>
<p>Now we have these cluster classifications, how can we link them to people? Try using the <strong>Mid-Year Population Estimates 2019</strong> that you can download below to:</p>
<ul>
<li>calculate the total number of people associated with each cluster group <strong>for England and Wales as a whole</strong>; and</li>
<li>create a pretty data visualisation showing the results (no map!).</li>
</ul>
<section id="file-download" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="file-download">File download</h4>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">File</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LSOA-level Mid-Year Population Estimates England and Wales 2019</td>
<td style="text-align: left;"><code>csv</code></td>
<td style="text-align: left;"><a href="https://github.com/jtvandijk/GEOG0114/tree/master/data/zip/mye_pop_2019_lsoa.zip">Download</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Lower-layer Super Output Areas Great Britain 2011</td>
<td style="text-align: left;"><code>shp</code></td>
<td style="text-align: left;"><a href="https://github.com/jtvandijk/GEOG0114/tree/master/data/zip/gb_lsoa11_sim.zip">Download</a></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="k-means-clustering" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="k-means-clustering"><span class="header-section-number">1.3.3</span> k-means clustering</h3>
<p>In several cases, including the <a href="http://josis.org/index.php/josis/article/view/232/150">2011 residential-based area classifications</a> and the Internet User Classification, a technique called <strong>k-means clustering</strong> is used in the creation of a geodemographic classification. K-means clustering aims to partition a set of observations into a number of clusters (<em>k</em>), in which each observation will be assigned to the cluster with the nearest mean. As such, a cluster refers to a collection of data points aggregated together because of certain similarities (i.e.&nbsp;standardised scores of your input data). In order to run a <strong>k-means clustering</strong>, you first define a target number <em>k</em> of clusters that you want. The k-means algorithm subsequently assigns every observation to one of the clusters by finding the solution that minimises the total within-cluster variance. For the second part of this week’s practical material, we will be replicating part of the Internet User Classification for Great Britain. For this we will be using an MSOA-level input data set containing various socio-demographic and socio-economic variables that you can download below together with the MSOA administrative boundaries.</p>
<p>The data set contains the following variables:</p>
<table class="table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>msoa11cd</code></td>
<td>MSOA Code</td>
</tr>
<tr class="even">
<td><code>age_total</code>, <code>age0to4pc</code>, <code>age5to14pc</code>, <code>age16to24pc</code>, <code>age25to44pc</code>, <code>age45to64pc</code>, <code>age75pluspc</code></td>
<td>Percentage of people in various age groups</td>
</tr>
<tr class="odd">
<td><code>nssec_total</code>, <code>1_higher_managerial</code>, <code>2_lower_managerial</code>, <code>3_intermediate_occupations</code>, <code>4_employers_small_org</code>, <code>5_lower_supervisory</code>, <code>6_semi_routine</code>, <code>7_routine</code>, <code>8_unemployed</code></td>
<td>Percentage of people in selected operational categories and sub-categories classes drawn from the National Statistics Socio-economic Classification (<a href="https://www.ons.gov.uk/methodology/classificationsandstandards/otherclassifications/thenationalstatisticssocioeconomicclassificationnssecrebasedonsoc2010">NS-SEC</a>)</td>
</tr>
<tr class="even">
<td><code>avg_dwn_speed</code>, <code>avb_superfast</code>, <code>no_decent_bband</code>, <code>bband_speed_under2mbs</code>, <code>bband_speed_under10mbs</code>, <code>bband_speed_over30mbs</code></td>
<td>Measures of broadband use and internet availability</td>
</tr>
</tbody>
</table>
<section id="file-download-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="file-download-1">File download</h4>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">File</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Middle-layer Super Output Areas Great Britain 2011</td>
<td style="text-align: left;"><code>shp</code></td>
<td style="text-align: left;"><a href="https://github.com/jtvandijk/GEOG0114/tree/master/data/zip/gb_msoa11_sim.zip">Download</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">MSOA-level input variables for IUC</td>
<td style="text-align: left;"><code>csv</code></td>
<td style="text-align: left;"><a href="https://github.com/jtvandijk/GEOG0114/tree/master/data/zip/msoa_iuc_input.zip">Download</a></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>iuc_input <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/index/msoa-iuc-input.csv"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iuc_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 23
  msoa11cd  age_total age0to4pc age5to…¹ age16…² age25…³ age45…⁴ age75…⁵ nssec…⁶
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 E02000001      7375    0.032    0.0388  0.0961   0.407   0.273  0.0607    5816
2 E02000002      6775    0.0927   0.122   0.113    0.280   0.186  0.0980    3926
3 E02000003     10045    0.0829   0.102   0.118    0.306   0.225  0.0646    6483
4 E02000004      6182    0.0590   0.102   0.139    0.254   0.250  0.0886    4041
5 E02000005      8562    0.0930   0.119   0.119    0.299   0.214  0.0501    5368
6 E02000007      8791    0.103    0.125   0.129    0.285   0.197  0.0688    5158
# … with 14 more variables: `1_higher_managerial` &lt;dbl&gt;,
#   `2_lower_managerial` &lt;dbl&gt;, `3_intermediate_occupations` &lt;dbl&gt;,
#   `4_employers_small_org` &lt;dbl&gt;, `5_lower_supervisory` &lt;dbl&gt;,
#   `6_semi_routine` &lt;dbl&gt;, `7_routine` &lt;dbl&gt;, `8_unemployed` &lt;dbl&gt;,
#   avg_dwn_speed &lt;dbl&gt;, avb_superfast &lt;dbl&gt;, no_decent_bband &lt;dbl&gt;,
#   bband_speed_under2mbs &lt;dbl&gt;, bband_speed_under10mbs &lt;dbl&gt;,
#   bband_speed_over30mbs &lt;dbl&gt;, and abbreviated variable names ¹​age5to14pc, …</code></pre>
</div>
</div>
<p>Before running our <strong>k-means</strong> clustering algorithm, we need to extract the data which we want to use; i.e.&nbsp;we need to remove all the columns with data that we do not want to include in the clustering process.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># column names</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(iuc_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "msoa11cd"                   "age_total"                 
 [3] "age0to4pc"                  "age5to14pc"                
 [5] "age16to24pc"                "age25to44pc"               
 [7] "age45to64pc"                "age75pluspc"               
 [9] "nssec_total"                "1_higher_managerial"       
[11] "2_lower_managerial"         "3_intermediate_occupations"
[13] "4_employers_small_org"      "5_lower_supervisory"       
[15] "6_semi_routine"             "7_routine"                 
[17] "8_unemployed"               "avg_dwn_speed"             
[19] "avb_superfast"              "no_decent_bband"           
[21] "bband_speed_under2mbs"      "bband_speed_under10mbs"    
[23] "bband_speed_over30mbs"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract columns by index</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="ot">&lt;-</span> iuc_input[, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">17</span>, <span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>)]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cluster_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 17
  age0to4pc age5to14pc age16to…¹ age25…² age45…³ age75…⁴ 1_hig…⁵ 2_low…⁶ 3_int…⁷
      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1    0.032      0.0388    0.0961   0.407   0.273  0.0607  0.385    0.339  0.0781
2    0.0927     0.122     0.113    0.280   0.186  0.0980  0.0568   0.171  0.143 
3    0.0829     0.102     0.118    0.306   0.225  0.0646  0.0818   0.208  0.182 
4    0.0590     0.102     0.139    0.254   0.250  0.0886  0.0678   0.206  0.191 
5    0.0930     0.119     0.119    0.299   0.214  0.0501  0.0494   0.166  0.156 
6    0.103      0.125     0.129    0.285   0.197  0.0688  0.0564   0.163  0.136 
# … with 8 more variables: `4_employers_small_org` &lt;dbl&gt;,
#   `5_lower_supervisory` &lt;dbl&gt;, `6_semi_routine` &lt;dbl&gt;, `7_routine` &lt;dbl&gt;,
#   `8_unemployed` &lt;dbl&gt;, avg_dwn_speed &lt;dbl&gt;, avb_superfast &lt;dbl&gt;,
#   no_decent_bband &lt;dbl&gt;, and abbreviated variable names ¹​age16to24pc,
#   ²​age25to44pc, ³​age45to64pc, ⁴​age75pluspc, ⁵​`1_higher_managerial`,
#   ⁶​`2_lower_managerial`, ⁷​`3_intermediate_occupations`</code></pre>
</div>
</div>
<p>We also need to rescale the data so all input data are presented on a comparable scale: the average download speed data (i.e.&nbsp;<code>avg_dwn_speed</code>) is very different to the other data that, for instance, represent the percentage of the population by different age groups.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(cluster_data)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cluster_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      age0to4pc age5to14pc age16to24pc age25to44pc age45to64pc age75pluspc
[1,] -1.7579913 -2.8680309 -0.36823669   2.1768529   0.2561260  -0.6039803
[2,]  1.9519376  1.6403191 -0.05766949   0.1671857  -1.5639740   0.6215590
[3,]  1.3549320  0.5475394  0.02888699   0.5773908  -0.7424464  -0.4769094
[4,] -0.1050147  0.5938501  0.40759191  -0.2402277  -0.2247116   0.3136111
[5,]  1.9687596  1.5173858  0.05639359   0.4733916  -0.9785969  -0.9539525
[6,]  2.6064366  1.8434062  0.22116720   0.2379171  -1.3168781  -0.3384050
     1_higher_managerial 2_lower_managerial 3_intermediate_occupations
[1,]           4.4185012          1.8391416                 -2.2291104
[2,]          -0.8510113         -0.9272602                  0.1031344
[3,]          -0.4499409         -0.3266302                  1.5123844
[4,]          -0.6741298         -0.3469851                  1.8104058
[5,]          -0.9705088         -1.0065195                  0.5809449
[6,]          -0.8571773         -1.0674213                 -0.1494470
     4_employers_small_org 5_lower_supervisory 6_semi_routine   7_routine
[1,]           -1.02298662         -2.53130431    -2.49888739 -1.81145433
[2,]            0.39745656         -0.67859270     1.05051667  0.08877827
[3,]            0.28308676         -0.37987493    -0.05595897 -0.52802287
[4,]            0.13591535          0.24587683    -0.15093353 -0.07008362
[5,]            0.09942212          0.42532220     0.76747039  0.35318453
[6,]           -0.18786941          0.05518013     0.56442659  0.57156979
     8_unemployed avg_dwn_speed avb_superfast no_decent_bband
[1,]   -0.5139854    -1.6561653    -5.2186970      -0.3797659
[2,]    1.1777334     0.7915882     0.5093876      -0.2031415
[3,]    0.7615830     0.6354463     0.5222597      -0.3797659
[4,]    0.2898589     0.9477301     0.5480039      -0.2472976
[5,]    0.8482656     0.4701196     0.2648177       0.2384195
[6,]    1.5510655     0.6813704     0.4965155      -0.1589854</code></pre>
</div>
</div>
<p>Now our data are all on the same scale, we will start by creating an elbow plot. The <a href="https://en.wikipedia.org/wiki/Elbow_method_(clustering)#:~:text=In%20cluster%20analysis%2C%20the%20elbow,number%20of%20clusters%20to%20use%60">elbow method</a> is a visual aid that can help in determining the number of clusters in a data set. Remember: this is important because with a <strong>k-means</strong> clustering you need to specify the numbers of clusters <em>a priori</em>!</p>
<p>The elbow method can help as it plots the total explained variation (‘Within Sum of Squares’) in your data as a function of the number of cluster. The idea is that you pick the number of clusters at the ‘elbow’ of the curve as this is the point in which the additional variation that would be explained by an additional cluster is decreasing. Effectively this means you are actually running the <strong>k-means</strong> clustering multiple times before running the actual <strong>k-means</strong> clustering algorithm.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create empty list to store the within sum of square values</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>wss_values <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># execute a k-means clustering for k=1, k=2, ..., k=15</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    wss_values[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(cluster_data, <span class="at">centers =</span> i, <span class="at">iter.max =</span> <span class="dv">30</span>)<span class="sc">$</span>withinss)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>wss_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 144143

[[2]]
[1] 110934.1

[[3]]
[1] 96047.06

[[4]]
[1] 82701.63

[[5]]
[1] 76194.75

 [ reached getOption("max.print") -- omitted 10 entries ]</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vector to dataframe</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>wss_values <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(wss_values)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>wss_values <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(wss_values))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add cluster numbers</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>wss_values<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">seq.int</span>(<span class="fu">nrow</span>(wss_values))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wss_values) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wss"</span>, <span class="st">"cluster"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot using ggplot2</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> wss_values, <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> wss)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">15</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Number of clusters"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Within sum of squares"</span>) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-geo-variables-that-cluster" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-variables-that-cluster-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.6: Within sum of squares by number of clusters</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on the elbow plot, we can now choose the number of clusters and it looks like <strong>7</strong> clusters would be a reasonable choice.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The interpretation of an elbow plot can be quite subjective and often multiple options would be justified: <strong>6</strong>, <strong>8</strong>, and perhaps <strong>9</strong> clusters also do not look unreasonable. You would need to try the different options and see what output you get to determine the ‘optimal’ solution. However, at very least, the elbow plot does give you an idea of what would potentially be an adequate number of clusters.</p>
</div>
</div>
</div>
<p>Now we have decided on the number of clusters (i.e.&nbsp;<strong>7</strong> clusters), we can run our cluster analysis. We will be running this analysis 10 times because there is an element of randomness within the clustering, and we want to make sure we get the optimal clustering output.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create empty list to store the results of the clustering</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create empty variable to store fit</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># run the k-means 10 times</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep track of the runs</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"starting run: "</span>, i))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run the k-means clustering algorithm to extract 7 clusters</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    clust7 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="at">x =</span> cluster_data, <span class="at">centers =</span> <span class="dv">7</span>, <span class="at">iter.max =</span> <span class="fl">1e+06</span>, <span class="at">nstart =</span> <span class="dv">1</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the total within sum of squares for the run and</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    fit[i] <span class="ot">&lt;-</span> clust7<span class="sc">$</span>tot.withinss</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update the results of the clustering if the total within sum of squares</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for the run is lower than any of the runs that have been executed so far</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fit[i] <span class="sc">&lt;</span> <span class="fu">min</span>(fit[<span class="dv">1</span><span class="sc">:</span>(i <span class="sc">-</span> <span class="dv">1</span>)])) {</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> clust7</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "starting run: 1"
[1] "starting run: 2"
[1] "starting run: 3"
[1] "starting run: 4"
[1] "starting run: 5"
[1] "starting run: 6"
[1] "starting run: 7"
[1] "starting run: 8"
[1] "starting run: 9"
[1] "starting run: 10"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>clusters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>K-means clustering with 7 clusters of sizes 2050, 542, 741, 186, 1818, 1106, 2037

Cluster means:
     age0to4pc  age5to14pc age16to24pc age25to44pc age45to64pc age75pluspc
  1_higher_managerial 2_lower_managerial 3_intermediate_occupations
  4_employers_small_org 5_lower_supervisory 6_semi_routine  7_routine
  8_unemployed avg_dwn_speed avb_superfast no_decent_bband
 [ reached getOption("max.print") -- omitted 7 rows ]

Clustering vector:
[1] 3 6 7 7 6
 [ reached getOption("max.print") -- omitted 8475 entries ]

Within cluster sum of squares by cluster:
[1] 11694.290  6277.839  7810.400  3401.821 12888.519
 [ reached getOption("max.print") -- omitted 2 entries ]
 (between_SS / total_SS =  56.3 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
 [ reached getOption("max.print") -- omitted 4 entries ]</code></pre>
</div>
</div>
<p>We now have to execute a bit of post-processing to extract some useful summary data for each cluster: the cluster size (<code>size</code>) and mean values for each cluster.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assign to new variable for clarity</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>kfit <span class="ot">&lt;-</span> clusters</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster sizes</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>kfit_size <span class="ot">&lt;-</span> kfit<span class="sc">$</span>size</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>kfit_size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2050  542  741  186 1818
 [ reached getOption("max.print") -- omitted 2 entries ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean values for each variable in each cluster</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>kfit_mean <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">aggregate</span>(cluster_data, <span class="at">by =</span> <span class="fu">list</span>(kfit<span class="sc">$</span>cluster), <span class="at">FUN =</span> mean))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(kfit_mean)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"cluster"</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>kfit_mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 18
  cluster age0to4pc age5to14pc age16to…¹ age25…² age45…³ age75…⁴ 1_hig…⁵ 2_low…⁶
    &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1       1  -0.00623    -0.0805   -0.0519 -0.157   0.0898   0.162 -0.838   -0.851
2       2  -0.879      -0.149    -0.523  -0.997   1.22     0.553  0.0242   0.225
3       3   0.326      -0.919     0.208   2.04   -1.23    -0.927  1.50     1.26 
4       4  -1.52       -2.68      5.42    0.113  -2.62    -1.28   0.870    0.223
5       5  -0.680      -0.0427   -0.464  -0.774   0.764    0.858  0.841    0.890
6       6   1.57        1.14      0.382   0.626  -1.13    -0.955 -0.906   -1.26 
7       7   0.0167      0.118    -0.172   0.0200  0.202   -0.104 -0.0480   0.210
# … with 9 more variables: `3_intermediate_occupations` &lt;dbl&gt;,
#   `4_employers_small_org` &lt;dbl&gt;, `5_lower_supervisory` &lt;dbl&gt;,
#   `6_semi_routine` &lt;dbl&gt;, `7_routine` &lt;dbl&gt;, `8_unemployed` &lt;dbl&gt;,
#   avg_dwn_speed &lt;dbl&gt;, avb_superfast &lt;dbl&gt;, no_decent_bband &lt;dbl&gt;, and
#   abbreviated variable names ¹​age16to24pc, ²​age25to44pc, ³​age45to64pc,
#   ⁴​age75pluspc, ⁵​`1_higher_managerial`, ⁶​`2_lower_managerial`</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform shape to tidy format</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>kfit_mean_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(kfit_mean, <span class="at">cols =</span> (<span class="sc">-</span>cluster))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot using ggplot2</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kfit_mean_long, <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> value, <span class="at">fill =</span> name)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Mean value"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-geo-plot-those-clusters-with-a-graph" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-plot-those-clusters-with-a-graph-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.7: Mean variable values by cluster</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Your values may be slightly different due to the random choice of initial cluster centres.</p>
</div>
</div>
</div>
<p>Looking at the table with the mean values for each cluster and the barplot, we can see that variables contribute differently to the different clusters. The graph is a little busy, so you might want to look at the cluster groups or variables individually to get a better picture of each cluster.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot using ggplot2</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kfit_mean_long[kfit_mean_long<span class="sc">$</span>cluster <span class="sc">==</span> <span class="dv">1</span>, ], <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> value,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> name)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Mean value"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-geo-plot-those-clusters-with-a-graph-just-one" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-plot-those-clusters-with-a-graph-just-one-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.8: Mean variable values for cluster 1</figcaption>
</figure>
</div>
</div>
</div>
<p>We can also show the results of our geodemographic classification on a map.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read shape</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>msoa <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/boundaries/gb_msoa11_sim.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gb_msoa11_sim' from data source 
  `/Users/justinvandijk/Library/CloudStorage/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0114Q/data/boundaries/gb_msoa11_sim.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 8480 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 5513 ymin: 5342.7 xmax: 655604.7 ymax: 1220302
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set projection</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(msoa) <span class="ot">=</span> <span class="dv">27700</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># simplify for speedier plotting</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>msoa <span class="ot">&lt;-</span> <span class="fu">st_simplify</span>(msoa, <span class="at">dTolerance =</span> <span class="dv">100</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(iuc_input, kfit<span class="sc">$</span>cluster)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>msoa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(msoa, cluster_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="at">geo_code =</span> <span class="st">"msoa11cd"</span>))</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(msoa) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"kfit$cluster"</span>) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-geo-map-the-iuc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="01-geodemographics_files/figure-html/fig-geo-map-the-iuc-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.9: Spatial pattern of our geodemographic classification</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Your map might look different as the cluster numbers are not consistently assigned and therefore colours can be map onto the cluster numbers differently.</p>
</div>
</div>
</div>
</section>
</section>
<section id="task-geo-2" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="task-geo-2"><span class="header-section-number">1.3.4</span> Tutorial task II</h3>
<p>The creation of a geodemographic classification is an <strong>iterative process</strong> of trial and error that involves the addition and removal of variables as well as experimentation with different numbers of clusters. It also might be, for instances, that some clusters are very focused on one group of data (e.g.&nbsp;age) and it could be an idea to group some ages together. If you want to make changes to the clustering solution, you can simply re-run the analysis with a different set of variables or with a different number of clusters by updating the code. However, it would be even simpler if you could automate some of the process.</p>
<p>Try to create a <strong>R function</strong> that:</p>
<ol type="1">
<li>takes <em>at least</em> the following three arguments: <strong>a data frame that contains your input data</strong>, <strong>the number of clusters that you want</strong>, and <strong>a list of input variables</strong>;</li>
<li>executes a <strong>k-means</strong> clustering on the input variables and the specified number of clusters; and,</li>
<li>produces a <code>csv</code> file that contains the <strong>table of means</strong> of the solution.</li>
</ol>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<ol type="1">
<li>Your function could look something like: <code>run-kmeans(dataframe,number_of_clusters,input_variables)</code></li>
<li>The list of input variables does not have to be a list of <em>names</em>, but can also be a list containing the index values of the columns.</li>
<li>Have a look at <a href="https://r4ds.had.co.nz/functions.html">Hadley Wickhams explanation of functions</a> in R.</li>
</ol>
</div>
</div>
</div>
</section>
</section>
<section id="byl-geo" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="byl-geo"><span class="header-section-number">1.4</span> Before you leave</h2>
<p>Having finished this tutorial, you should now understand the basics of a geodemographic classification. In addition, you should have written a simple function. Although <a href="https://www.youtube.com/watch?v=8iwBM_YB1sE">you have now reached the end of this week’s content</a>, you could try and improve your function. Consider:</p>
<ol type="1">
<li>Including <em>maps</em> or <em>graphs</em> in the code that get automatically saved.</li>
<li>Ensuring that the <code>csv</code> outcome does <strong>not</strong> get overwritten every time you run you function.</li>
<li>Including optional arguments in your function with <strong>default values</strong> if certain values are not specified.</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Module overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02-network.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transport Network Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>